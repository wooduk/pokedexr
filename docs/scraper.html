---

title: Bulbapedia Scraper

keywords: fastai
sidebar: home_sidebar

summary: "A collection of functions to help scrape Pokemon Card content from the Bulbapedia Site "
description: "A collection of functions to help scrape Pokemon Card content from the Bulbapedia Site "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_scraper.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bulbapedia is an encyclopedia about Pokémon to which anyone can contribute and a useful source for building a labelled dataset of trading card images.</p>
<p>For (The Pokedexr Project)[link] the bulbapedia has images of the Japanese cards and the card descriptions in English.</p>
<p>There are 3 basic parts here:</p>
<ol>
<li><p>Some general convenience functions</p>
</li>
<li><p>Tools for extracting lists of cards from the <a href="https://bulbapedia.bulbagarden.net/wiki/GX_Starter_Decks_(TCG">Deck lists</a>) or Set Lists, including a link to the <a href="https://bulbapedia.bulbagarden.net/wiki/Heatmor_(TCG">detailed description page</a>)) for each card.</p>
</li>
<li><p>Tools for extracting meta-data, including links to card images, from the detailed description pages.</p>
</li>
<li><p>Tools for fetching the card images themselves and storing them.</p>
</li>
</ol>
<p>For most of the extraction rules I used the browser's developer tools to find any tags and attributes that would allow me to scrape a list of cards from the deck list pages.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-Utility-functions">1. Utility functions<a class="anchor-link" href="#1.-Utility-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="bulba_url_for" class="doc_header"><code>bulba_url_for</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>bulba_url_for</code>(<strong><code>resource</code></strong>)</p>
</blockquote>
<p>Returns full url for bulbapedia page given last part or url (resource)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sanitize_name" class="doc_header"><code>sanitize_name</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sanitize_name</code>(<strong><code>name</code></strong>)</p>
</blockquote>
<p>For extracting images we need a cleaned up version of the card name
that appears in Deck of set lists</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fetch_page_soup" class="doc_header"><code>fetch_page_soup</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fetch_page_soup</code>(<strong><code>resource</code></strong>)</p>
</blockquote>
<p>Fetches a page and returns a beautiful soup.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_card_list" class="doc_header"><code>save_card_list</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_card_list</code>(<strong><code>cards</code></strong>, <strong><code>fname</code></strong>=<em><code>'cards.pkl'</code></em>)</p>
</blockquote>
<p>Pickles the card list</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_card_list" class="doc_header"><code>load_card_list</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_card_list</code>(<strong><code>cards</code></strong>, <strong><code>fname</code></strong>=<em><code>'cards.pkl'</code></em>)</p>
</blockquote>
<p>Load a pickled card list</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">BUCKET_NAME</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;POKE_S3_BUCKETNAME&#39;</span><span class="p">)</span>
<span class="n">LOCAL_FOLDER</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">store_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span> 
    <span class="k">if</span> <span class="n">location</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s3&#39;</span><span class="p">:</span>
        <span class="n">bucket</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">push_image_to_s3</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_image_local</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">push_image_to_s3</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">bucket_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">dr</span><span class="p">,</span> <span class="n">fname</span><span class="p">]))</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">Body</span><span class="o">=</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">image_data</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2"> to S3/</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="k">def</span> <span class="nf">save_image_local</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">dr</span><span class="p">,</span> <span class="n">fname</span><span class="p">]))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Extracting-cards-from-Deck-or-Set-Lists">2. Extracting cards from Deck or Set Lists<a class="anchor-link" href="#2.-Extracting-cards-from-Deck-or-Set-Lists"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A function to fetch a list of card name, numbers and links to details page from bulbapedia.
Requires a valid Deck or Set List reference to work. Here are the assumptions about how the page is structured:</p>
<ul>
<li>For <code>set lists</code> the links to the details pages were contained in the <code>href</code> attribute of elements that has the class <code>mw-redirect</code>.</li>
<li><code>Deck Lists</code> are buried in nested tables. The best I could come up with was to note the headings of the tables are wrapped in \<b> tags, find those. Then work back up the parents until you find the correct table parent. Now iterate over the rows of that table to extract information</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fetch_card_list" class="doc_header"><code>fetch_card_list</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fetch_card_list</code>(<strong><code>list_name</code></strong>, <strong><code>req_decks</code></strong>=<em><code>[]</code></em>)</p>
</blockquote>
<p>Returns a list of card names, numbers and links to details pages from given list</p>
<p>list_name -- reference to the page containing the list on bulbapedia
decks -- decks to be taken from a desk list, ignored for set list</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#r = requests.get(bulba_url_for(cards[&#39;Charmander&#39;].get(&#39;details_page_ref&#39;,&#39;notexist&#39;)))</span>
<span class="c1">#soup = BeautifulSoup(r.content,&#39;html.parser&#39;)</span>
<span class="n">bulba_url_for</span><span class="p">(</span><span class="n">cards</span><span class="p">[</span><span class="s1">&#39;Charmander&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_page_ref&#39;</span><span class="p">,</span><span class="s1">&#39;notexist&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;https://bulbapedia.bulbagarden.net/wiki/Charmander_(GX_Starter_Deck_11)&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The content we want is in a nested table structure under (well, after) the heading 'Card Text'.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pokemon_card_text_table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Card_text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
<span class="n">url_for</span><span class="p">(</span><span class="n">cards</span><span class="p">[</span><span class="s1">&#39;Charmander&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_page_ref&#39;</span><span class="p">,</span><span class="s1">&#39;notexist&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;https://bulbapedia.bulbagarden.net/wiki/Charmander_(GX_Starter_Deck_11)&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3.-Updating-a-list-of-cards-with-information-from-the-details-pages">3. Updating a list of cards with information from the details pages<a class="anchor-link" href="#3.-Updating-a-list-of-cards-with-information-from-the-details-pages"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Also want some other information from the details page, namely the card text and the numbers of the cards.</p>
<p>Extracting the card text was a bit interesting as the format of the html was different for the Trainer cards than Pokemon Cards. (Were not interested in the energy cards here)</p>
<p>First an example of the Pokemon card. Let's stick with Charmander.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Image-Urls">Image Urls<a class="anchor-link" href="#Image-Urls"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>[TODO] Description of Extract the image...</p>
<p>The card page can, but doesn't always, include a 'gallery' section where images are displayed if more than one version of the artwork exists. For example different editions of the cards use different artists. At first I'm not sure of what to do with this. On the one hand I know that in my specific case I only have 1 version of the artwork to recognise. But as a human I would still be able to recognise a pokemon across the different depictions. I think it is best to fetch the images and then experiment later with the effect of including/excluding them later.</p>
<p>Some of the pages have a gallery section with multiple artworks. The gallery section, if it exists, looks like this:</p>
<p><code>&lt;span id="Gallery&gt; ... &lt;span&gt;</code></p>
<p>But the table of images that we want is not encapsulated in a <code>&lt;div&gt;</code> so we can't use that section heading to get the images embedded as children within it.</p>
<p>Instead we can extract all <code>&lt;img&gt;</code> tags from the page and then filter out unwanted images. Using developer tools we can see that the pokemon/entity name is embedded in the <code>alt</code> attribute of the <code>img</code> tag for the images we want. So we can use the name we collected earlier to extract the images we want.</p>
<p>A slight complication is that the name as it appears in the attribute differs from the name we've recorded. It has any underscore, dash, spaces, punctuation removed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="De-duplicating-the-list-of-image-urls">De-duplicating the list of image urls<a class="anchor-link" href="#De-duplicating-the-list-of-image-urls"> </a></h4><p>The list of image urls extracted often has inexact duplicates: they are just different sizes of the same image. The <a href="/pokedexr/scraper#dedupe_image_urls"><code>dedupe_image_urls</code></a> function aims to keep only one set of each image be examining the path but ignoring the image size part of the file name. Implemented using a dictionary so we keep the last version a file that is in the list.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dedupe_image_urls" class="doc_header"><code>dedupe_image_urls</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dedupe_image_urls</code>(<strong><code>urls</code></strong>)</p>
</blockquote>
<p>Try to de-duplicate a list of image urls given the path structure</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now do it</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_image_urls" class="doc_header"><code>extract_image_urls</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L123" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_image_urls</code>(<strong><code>soup</code></strong>, <strong><code>name</code></strong>)</p>
</blockquote>
<p>Given the details page soup, extract image urls</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Card-Text">Card Text<a class="anchor-link" href="#Card-Text"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The 'Card Text' is the english translation of the main text on the card (ie.. moves, instructions). I couldn't find any useful tags to extract this data so I've just had to create a loop to parse the tables relying on an assumption about the order of the content. It was just trial and error to develop this.</p>
<p>The 'Trainer' cards and 'Pokemon' cards have different structures so each has a different function to extract information. Energy cards have no text. Here is a function that determines the difference from the soup</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="isTrainerCard" class="doc_header"><code>isTrainerCard</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>isTrainerCard</code>(<strong><code>soup</code></strong>)</p>
</blockquote>
<p>Given the soup of card details page, detect if this is a trainer card.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now a function to extract the card text from a Pokemon card. <a href="https://bulbapedia.bulbagarden.net/wiki/Charmander_(GX_Starter_Deck_11">Charmander</a> is an example of a pokemon card.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_pokemon_card_text" class="doc_header"><code>extract_pokemon_card_text</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_pokemon_card_text</code>(<strong><code>card_text_table</code></strong>)</p>
</blockquote>
<p>Given the soup of the details page, return the card text for a trainer card.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># How to use it</span>
<span class="c1">#pokemon_card_text_table = soup.find(id=&#39;Card_text&#39;).findNext()</span>
<span class="c1">#extract_pokemon_card_text(pokemon_card_text_table)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the equivalent for a Trainer card. Trainer cards are slightly different and thankfully, simpler. <a href="https://bulbapedia.bulbagarden.net/wiki/Professor_Kukui_(GX_Starter_Deck_118">Professor Kukui</a>) is an example trainer card</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_trainer_card_text" class="doc_header"><code>extract_trainer_card_text</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L191" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_trainer_card_text</code>(<strong><code>card_text_table</code></strong>)</p>
</blockquote>
<p>Given the soup of the details page, return the card text for a trainer card.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># example</span>
<span class="c1"># Prof. Kukui is card 12 in our list</span>
<span class="n">prof_kukui</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="n">cards</span><span class="p">[</span><span class="s1">&#39;Professor Kukui&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_page_ref&#39;</span><span class="p">,</span><span class="s1">&#39;notexist&#39;</span><span class="p">)))</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">prof_kukui</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>


<span class="n">isTrainerCard</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="s1">&#39;/wiki/Trainer_card_(TCG)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">isTrainerCard</span><span class="p">)</span> <span class="c1"># This is non if not a trainer card</span>

<span class="k">if</span> <span class="n">isTrainerCard</span><span class="p">:</span>
    <span class="n">trainer_card_text_table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Card_text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">extract_trainer_card_text</span><span class="p">(</span><span class="n">trainer_card_text_table</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;a href=&#34;/wiki/Trainer_card_(TCG)&#34; title=&#34;Trainer card (TCG)&#34;&gt;&lt;span style=&#34;color:#000;&#34;&gt;Trainer&lt;/span&gt;&lt;/a&gt;
[{&#39;type&#39;: &#39;info&#39;, &#39;description&#39;: &#34;Draw 2 cards. During this turn, your Pokémon&#39;s attacks do 20 more damage to your opponent&#39;s Active Pokémon (before applying Weakness and Resistance).&#34;}, {&#39;type&#39;: &#39;info&#39;, &#39;description&#39;: &#39;You may play only 1 Supporter card during your turn (before your attack).&#39;}]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Wrap those functions for each card type up into something more convenient.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_card_text" class="doc_header"><code>extract_card_text</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_card_text</code>(<strong><code>soup</code></strong>)</p>
</blockquote>
<p>Given the soup for a details page, return any available card text</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Alternative-Card-Numbers">Alternative Card Numbers<a class="anchor-link" href="#Alternative-Card-Numbers"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'm not quite sure how they work yet, but I noticed a list of card numbers on the details page too. These feel like they may be useful in the future so let's extract those too.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_card_numbers" class="doc_header"><code>get_card_numbers</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_card_numbers</code>(<strong><code>soup</code></strong>)</p>
</blockquote>
<p>Given the details page soup, extract any available card numbers</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prof_kukui</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="n">cards</span><span class="p">[</span><span class="s1">&#39;Professor Kukui&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details_page_ref&#39;</span><span class="p">,</span><span class="s1">&#39;notexist&#39;</span><span class="p">)))</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">prof_kukui</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
<span class="n">get_card_numbers</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;alt_card_num&#39;: {&#39;jp&#39;: [&#39;096/SM-P&#39;,
   &#39;004/018&#39;,
   &#39;059/060&#39;,
   &#39;054/059&#39;,
   &#39;066/060&#39;,
   &#39;118/131&#39;],
  &#39;en&#39;: [&#39;128/149&#39;, &#39;148/149&#39;]}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="wrapped-up">wrapped up<a class="anchor-link" href="#wrapped-up"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_card_details" class="doc_header"><code>update_card_details</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L230" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_card_details</code>(<strong><code>cards</code></strong>)</p>
</blockquote>
<p>Procedure: Given a list of cards (output of fetch_card_lists()) augment the list with the relevant details.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fetching-card-images-and-storing">Fetching card images and storing<a class="anchor-link" href="#Fetching-card-images-and-storing"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fetch_image" class="doc_header"><code>fetch_image</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L255" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fetch_image</code>(<strong><code>img_url</code></strong>)</p>
</blockquote>
<p>Given a url produced by extract_image_urls() fetch the image content (bytes) and the filename.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-images">Saving images<a class="anchor-link" href="#Saving-images"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_image_local</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">push_image_to_s3</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">bucket_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_image" class="doc_header"><code>save_image</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L269" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_image</code>(<strong><code>image_data</code></strong>, <strong><code>fname</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fetch_images_for_cards" class="doc_header"><code>fetch_images_for_cards</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L289" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fetch_images_for_cards</code>(<strong><code>cards</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fetch_card_img_s3" class="doc_header"><code>fetch_card_img_s3</code><a href="https://github.com/wooduk/pokedexr/tree/master/pokedexr/scraper.py#L301" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fetch_card_img_s3</code>(<strong><code>name</code></strong>, <strong><code>bucket</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 01_scraper.ipynb.
Converted 02_augmentation.ipynb.
Converted 03_interpretation.ipynb.
Converted 99_scratch.ipynb.
Converted ExampleBlog.ipynb.
Converted Training.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

